<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>India Govt Truck Navigation</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"/>

<style>
body { margin:0; font-family:Arial; }
h2 { background:#1e88e5; color:white; text-align:center; padding:10px; margin:0; }

#searchBoxDiv {
    padding:10px;
    text-align:center;
    background:#f5f5f5;
}

input, select {
    width:14%;
    padding:8px;
    margin:4px;
}

button {
    padding:8px 14px;
    cursor:pointer;
}

#map {
    height: calc(85vh - 45px);
}

/* Bottom taskbar */
#taskbar {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 45px;
    background: #1e88e5;
    color: white;
    display: flex;
    justify-content: space-around;
    align-items: center;
    font-size: 14px;
}
</style>
</head>

<body>

<h2>üáÆüá≥ India Government Truck Navigation</h2>

<div id="searchBoxDiv">

    <!-- Map mode -->
    <select id="mapMode" onchange="changeMapMode()">
        <option value="normal">Normal</option>
        <option value="2d">2D</option>
        <option value="3d">3D</option>
    </select>

    <!-- Vehicle type -->
    <select id="vehicleType">
        <option value="2">2 Wheeler</option>
        <option value="4" selected>4 Wheeler</option>
        <option value="8">8 Wheeler (Truck)</option>
        <option value="16">16 Wheeler (Heavy Truck)</option>
    </select>

    <!-- Locations -->
    <input id="fromInput" value="" placeholder="From">
    <input id="toInput" value="" placeholder="To">

    <button onclick="showRoute()">Show Route</button>
</div>

<div id="map"></div>

<!-- TASKBAR -->
<div id="taskbar">
    <span id="taskDistance">üìè Distance: -- km</span>
    <span id="taskTime">‚è± Travel Time: -- hrs</span>
    <span id="taskTruckTime">üöõ Truck Time Limit (Govt): --</span>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

<script>
/* MAP INIT */
var map = L.map('map').setView([22.5937, 78.9629], 4);

/* MAP LAYERS */
var normalLayer = L.tileLayer(
    'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', { maxZoom:18 }
);
var twoDLayer = L.tileLayer(
    'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:18 }
);
var threeDLayer = L.tileLayer(
    'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    { maxZoom:18 }
);
var labelLayer = L.tileLayer(
    'https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png',
    { maxZoom:18 }
);

normalLayer.addTo(map);

/* Change map mode */
function changeMapMode(){
    map.eachLayer(l => map.removeLayer(l));
    if(mapMode.value === "normal") normalLayer.addTo(map);
    if(mapMode.value === "2d") twoDLayer.addTo(map);
    if(mapMode.value === "3d"){ threeDLayer.addTo(map); labelLayer.addTo(map); }
}

/* ROUTING */
var routingControl;
var geoCache = {};

/* VEHICLE SPEED RULES */
var vehicleRules = {
    2:{ speed:45 },
    4:{ speed:60 },
    8:{ speed:45 },
    16:{ speed:35 }
};

/* üáÆüá≥ GOVERNMENT TRUCK ENTRY TIME (STANDARD INDIA) */
var govtTruckTime = {
    start: "22:00",   // 10 PM
    end:   "06:00"    // 6 AM
};

/* UPDATE TASKBAR ‚Äì GOVT TRUCK TIME */
function updateGovtTruckTime(vehicle){
    let bar = document.getElementById("taskTruckTime");

    if(vehicle < 8){
        bar.innerHTML = "üöõ Truck Time Limit (Govt): Not Applicable";
        return;
    }

    bar.innerHTML =
        "üöõ Truck Time Limit (Govt): " +
        govtTruckTime.start + " ‚Äì " + govtTruckTime.end;

    // Check current time
    let now = new Date();
    let cur = now.getHours()*60 + now.getMinutes();

    let s = govtTruckTime.start.split(":");
    let e = govtTruckTime.end.split(":");

    let sMin = (+s[0])*60 + (+s[1]);
    let eMin = (+e[0])*60 + (+e[1]);

    let allowed = (cur >= sMin || cur <= eMin);

    if(!allowed){
        alert(
            "üö´ GOVERNMENT TRUCK ENTRY RESTRICTED\n\n" +
            "Allowed Time:\n" +
            govtTruckTime.start + " ‚Äì " + govtTruckTime.end
        );
    }
}

/* GEOCODING */
function getLatLng(place, cb){
    if(geoCache[place]){ cb(geoCache[place]); return; }

    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${place}, India`)
        .then(r=>r.json())
        .then(d=>{
            geoCache[place] = [d[0].lat, d[0].lon];
            cb(geoCache[place]);
        });
}

/* SHOW ROUTE */
function showRoute(){
    let from = fromInput.value.trim();
    let to   = toInput.value.trim();
    let vehicle = parseInt(vehicleType.value);
    let speed = vehicleRules[vehicle].speed;

    updateGovtTruckTime(vehicle);

    getLatLng(from, function(f){
        getLatLng(to, function(t){

            if(routingControl) map.removeControl(routingControl);

            routingControl = L.Routing.control({
                waypoints:[ L.latLng(f[0],f[1]), L.latLng(t[0],t[1]) ],
                show:false,
                addWaypoints:false,
                lineOptions:{ styles:[{color:'blue',weight:6,opacity:0.9}] }
            }).addTo(map);

            routingControl.on('routesfound', function(e){
                let km = e.routes[0].summary.totalDistance / 1000;
                let hr = (km / speed).toFixed(2);

                taskDistance.innerHTML = "üìè Distance: " + km.toFixed(1) + " km";
                taskTime.innerHTML = "‚è± Travel Time: " + hr + " hrs";
            });
        });
    });
}

/* AUTO LOAD */
window.onload = showRoute;
</script>

</body>
</html>